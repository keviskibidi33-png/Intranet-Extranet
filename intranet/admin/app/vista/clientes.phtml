<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="es">
<!--<![endif]-->

<head>
  <?php include("head.php"); ?>
  <link rel="stylesheet" href="<?php echo ruta ?>app/css/geofal-redesign.css">
</head>

<body>
  <!-- Left Panel -->
  <?php include("header_left.php"); ?>

  <div id="right-panel" class="right-panel">
    <!-- Header-->
    <?php include("header_top.php"); ?>

    <!-- Header Section - Título, Botón y Búsqueda en una línea -->
    <div class="clientes-header-section">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <div class="clientes-header-container">
              <!-- Título de la Página - IZQUIERDA -->
              <div class="page-title-button">
                <h1 class="page-title-h1">EMPRESAS GEOFAL</h1>
              </div>
              
              <!-- Botón y Búsqueda agrupados a la DERECHA -->
              <div class="clientes-header-actions">
                <!-- Botón Agregar -->
                <div class="add-button-container">
                  <a href="<?= ruta ?>?pagina=clientes_agregar" class="btn-geofal-primary btn-add-empresa">
                    <i class="fa fa-plus"></i> Agregar Nueva Empresa
                  </a>
                </div>
                
                <!-- Barra de búsqueda -->
                <form action="<?= ruta ?>" method="get" class="search-form">
                  <input type="hidden" name="pagina" value="<?php echo $_GET['pagina'] ?>">
                  <input type="hidden" name="p" value="1">
                  <div class="input-group-search">
                    <?php if (!empty($_GET['b']) and isset($_GET['b'])): ?>
                      <a href="<?= ruta ?>?pagina=<?php echo $_GET['pagina'] ?>" class="btn btn-outline-secondary btn-todos">Todos</a>
                    <?php endif; ?>
                    <input type="text" class="form-control-search" name="b" placeholder="Buscar Empresa" value="<?php echo $get_b2 ?>">
                    <button class="btn btn-search" type="submit">
                      <i class="fa fa-search"></i>
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <?php if (isset($_GET['error']) and $_GET['error'] == '1'): ?>
                <div class="alert alert-danger">Usuario Existente</div>
              <?php endif; ?>

              <div class="table-responsive">
                <table class="table table-empresas-geofal">
                  <thead>
                    <tr>
                      <th>Ruc</th>
                      <th>Clave</th>
                      <th>Razón social</th>
                      <th>Representante</th>
                      <th>PDF</th>
                      <th>Acción</th>
                    </tr>
                  </thead>
                  <tbody>
                    <?php foreach ($mostrar_clientes_pagi as $m_clientes): ?>
                      <tr id="eli<?php echo $m_clientes['id'] ?>">
                        <!-- Columna Ruc -->
                        <td><?php echo htmlspecialchars($m_clientes['ruc'] ?? '') ?></td>
                        <!-- Columna Clave -->
                        <td><?php echo htmlspecialchars($m_clientes['clave']) ?></td>
                        <!-- Columna Razón social -->
                        <td><?php echo htmlspecialchars($m_clientes['razon_social']) ?></td>
                        <!-- Columna Representante -->
                        <td><?php echo htmlspecialchars($m_clientes['representante']) ?></td>
                        <!-- Columna PDF -->
                        <td>
                          <a href="<?= ruta ?>?pagina=pdf&id=<?php echo $m_clientes['id'] ?>" class="btn btn-agregar-pdf-tabla" title="Gestionar PDFs">
                            Agregar PDF
                          </a>
                        </td>
                        <!-- Columna Acción (al final) -->
                        <td>
                          <div class="btn-group-actions">
                            <a href="<?= ruta ?>?pagina=clientes_editar&id=<?php echo $m_clientes['id'] ?>" class="btn btn-outline-primary btn-sm" title="Editar">
                              <i class="fa fa-pencil"></i>
                            </a>
                            <a href="#" onclick="eliminar_todo('<?php echo ruta ?>?pagina=clientes','<?php echo $m_clientes['id'] ?>','eliminar_clientes')" class="btn btn-danger btn-sm" title="Eliminar">
                              <i class="fa fa-trash-o"></i>
                            </a>
                          </div>
                        </td>
                      </tr>
                    <?php endforeach; ?>
                  </tbody>
                </table>
              </div>

              <div class="pagination-wrapper">
                <?= $inicio->paginador($reload, $page, $total_pages, $adjacents, ruta, @$_GET['pagina'], $numrows, $get_b, '2'); ?>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <?php include("footer.php"); ?>
  
  <script>
    // Mostrar notificaciones de éxito
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const success = urlParams.get('success');
      
      if (success === 'cliente_agregado') {
        Swal.fire({
          icon: 'success',
          title: '¡Éxito!',
          text: 'La empresa se ha creado correctamente',
          timer: 3000,
          timerProgressBar: true,
          showConfirmButton: false
        });
        // Limpiar parámetro de la URL
        window.history.replaceState({}, document.title, window.location.pathname + window.location.search.replace(/[?&]success=[^&]+/, '').replace(/^&/, '?'));
      } else if (success === 'cliente_editado') {
        Swal.fire({
          icon: 'success',
          title: '¡Éxito!',
          text: 'La empresa se ha actualizado correctamente',
          timer: 3000,
          timerProgressBar: true,
          showConfirmButton: false
        });
        window.history.replaceState({}, document.title, window.location.pathname + window.location.search.replace(/[?&]success=[^&]+/, '').replace(/^&/, '?'));
      }
    });
  </script>
</body>
</html>

