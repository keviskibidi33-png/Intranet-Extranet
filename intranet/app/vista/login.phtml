<!doctype html>

<html>

<head>

<meta charset="utf-8">

<title>Sistema de logistica </title>



<link rel="stylesheet" href="<?php echo ruta?>include/css/login.css">





</head>



<body>





 



<div class="container">



<form action="<?php echo ruta?>login/" method="post">

    <h1>

       Iniciar Sesión

    </h1>

     <?php 

if(isset($_GET['error'])){

	$error=$_GET['error'];

}else{

	$error='0';

}

if(isset($_GET['b'])){

	$b_get=$_GET['b'];

}else{

	$b_get='0';

}	 

	 if($error=='error'){?>

<div class="alert alert-danger" role="alert"> Tú contraseña o rut esta mal escrito, intentalo nuevamente</div>

<?php }?>

    <div class="form-content">

      <input id="user-name" placeholder="RUC" name="ruc" type="text" />

      <input type="hidden" name="login" value="ok"> <input id="" name="r" type="hidden" value="<?=$b_get;?>" />

      <input id="password" placeholder="Contraseña" name="clave" type="password" />

     

      <br />

      <button class="button" type="submit">

       Ingresar

      </button>

      <br />

      <div class="signup-message">

  

      </div>

    </div>

  </form>

  <!-- jQuery y SweetAlert2 para manejar el login -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    $(document).ready(function() {
      $('form').on('submit', function(e) {
        e.preventDefault();
        
        var formData = $(this).serialize();
        var submitButton = $(this).find('button[type="submit"]');
        var originalText = submitButton.html();
        
        // Deshabilitar botón y mostrar carga
        submitButton.prop('disabled', true).html('Ingresando...');
        
        $.ajax({
          type: 'POST',
          url: '<?php echo ruta ?>login/',
          data: formData,
          dataType: 'json',
          success: function(response) {
            if (response.es == '1') {
              // Login exitoso
              Swal.fire({
                title: 'Accediendo',
                html: 'Cargando contenidos...',
                timer: 1500,
                timerProgressBar: true,
                didOpen: () => {
                  Swal.showLoading();
                }
              }).then(() => {
                window.location.href = '<?php echo ruta ?>ordenes';
              });
            } else {
              // Error en login
              Swal.fire({
                icon: 'error',
                title: 'Error de acceso',
                text: 'Tu contraseña o RUC está mal escrito, inténtalo nuevamente.',
                confirmButtonColor: '#f34d23'
              });
              submitButton.prop('disabled', false).html(originalText);
            }
          },
          error: function(xhr, status, error) {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'Ocurrió un error al intentar iniciar sesión. Por favor, inténtalo nuevamente.',
              confirmButtonColor: '#f34d23'
            });
            submitButton.prop('disabled', false).html(originalText);
          }
        });
      });
    });
  </script>


</div>













</body>

</html>